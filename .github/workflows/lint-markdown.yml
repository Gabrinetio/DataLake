# lint-markdown.yml - GitHub Actions para valida√ß√£o de Markdown

name: Lint Documenta√ß√£o

on:
  pull_request:
    paths:
      - 'docs/**'
      - 'infra/**'
      - '.github/workflows/lint-markdown.yml'
  push:
    branches:
      - main
      - develop
    paths:
      - 'docs/**'

jobs:
  markdown-lint:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Run Markdown Lint
        uses: nosborn/github-action-markdown-cli@v3.3.0
        with:
          files: docs
          config_file: '.markdownlint.json'
      
      - name: Check Doc Links
        run: |
          chmod +x docs/check-doc-links.sh
          ./docs/check-doc-links.sh docs/
      
      - name: Validate ADRs
        run: |
          # Verificar se todos os ADRs t√™m status e data
          for adr in docs/60-decisions/ADR-*.md; do
            if ! grep -q "^**Status:**" "$adr"; then
              echo "‚ùå ADR $adr sem Status"
              exit 1
            fi
            if ! grep -q "^**Data:**" "$adr"; then
              echo "‚ùå ADR $adr sem Data"
              exit 1
            fi
          done
          echo "‚úì Todos os ADRs v√°lidos"
      
      - name: Check for Secrets
        run: |
          # Verificar se h√° secrets/credenciais no c√≥digo
          if grep -r "password\s*=" docs/ --include="*.md" | grep -v "^Binary\|.md:.*password.*=\s*\$\|.md:.*password.*=\s*xxx"; then
            echo "‚ö†Ô∏è Verificar se h√° credenciais expostas em Markdown"
          fi
          exit 0

  spell-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Spell Check Portugu√™s
        uses: crate-ci/typos@master
        with:
          files: docs
          config: .typos.toml
        continue-on-error: true  # Aviso, n√£o falha

  index-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Verificar √çndice Atualizado
        run: |
          # Contar arquivos em docs
          docs_count=$(find docs -name "*.md" -type f | wc -l)
          
          # Verificar se README.md tem refer√™ncias
          if [ "$docs_count" -gt 10 ]; then
            echo "‚ÑπÔ∏è Encontrados $docs_count arquivos Markdown"
            echo "üìù Certifique-se de que docs/00-overview/README.md est√° atualizado"
          fi
